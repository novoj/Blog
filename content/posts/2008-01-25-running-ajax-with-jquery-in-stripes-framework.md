---
status: publish
published: true
title: Running AJAX with jQuery in Stripes Framework
author:
  display_name: Otec Fura
  login: admin
  email: novotnaci@gmail.com
  url: http://blog.novoj.net
author_login: admin
author_email: novotnaci@gmail.com
author_url: http://blog.novoj.net
excerpt: "<div style=\"margin: 10px; padding: 5px; border: 1px solid white; background-color:
  #333333; font-size: 90%\">\r\nThough most of articles at this blog are written in
  my native language - Czech, this one will be different. I have chosen an English
  to address wider community of Stripes developers - I think there would'nt be enough
  readers in our beautiful small country. So, please, excuse possible errors and mistakes
  in the article, I will try my best :-) .\r\n</div>\r\n\r\n<h3>Common introduction
  to AJAX in Stripes</h3>\r\n\r\nStripes framework offers basic but sufficient support
  for AJAX that is covered with article at <a href=\"http://www.stripesframework.org/display/stripes/AJAX\"
  target=\"_ new\">official web site</a>. Article recommends using commonly known
  <a href=\"http://www.prototypejs.org\" target=\"_new\">PrototypeJS</a> AJAX client
  side library. On the server side, request is processed by Stripes themselves by
  standard population and execution as any other http request (that means that data
  from client to server are sent as a standard URL encoded parameters). What you get
  is correctly populated and validated action bean - and until now you haven't even
  recognize, that request is made by JavaScript on the client side not even you have
  to care of it. You can access session, exchange cookies and so on.\r\n\r\n"
wordpress_id: 51
wordpress_url: http://blog.novoj.net/2008/01/25/running-ajax-with-jquery-in-stripes-framework/
date: '2008-01-25 08:06:40 +0100'
date_gmt: '2008-01-25 07:06:40 +0100'
categories:
- Java
- Web
- Stripes
- English
tags: []
comments:
- id: 1389
  author: Lukáš Vlček
  author_email: lukas.vlcek@gmail.com
  author_url: http://blog.lukas-vlcek.com/
  date: '2008-01-25 08:27:26 +0100'
  date_gmt: '2008-01-25 07:27:26 +0100'
  content: "Hi Jan,\r\n\r\nReally nice artice. Especially the encoding issue is interesting
    because I ran into similar problem now while using Stripes. This could help. Thanks!\r\n\r\nDemo
    of the application is sexy ;-)\r\n\r\nRegards,\r\nLukas"
- id: 1390
  author: Novoj
  author_email: novotnaci@gmail.com
  author_url: http://blog.novoj.net
  date: '2008-01-25 08:29:21 +0100'
  date_gmt: '2008-01-25 07:29:21 +0100'
  content: Yeah, but as Vlasta Vavru said in his article http://vavru.cz/ajax/jquery-je-sexy-javascriptova-knihovna-pro-ajax-dom-a-animace/
    jQuery itself is sexy.
- id: 1391
  author: Lukáš Vlček
  author_email: lukas.vlcek@gmail.com
  author_url: http://blog.lukas-vlcek.com/
  date: '2008-01-25 09:53:50 +0100'
  date_gmt: '2008-01-25 08:53:50 +0100'
  content: "I agree, it is sexy. However; the question is if this sole fact can be
    used as a justification for higher management :-)\r\n\r\nI used to use AjaxTags
    (http://ajaxtags.sourceforge.net/) in the past and it worked well too. I have
    switched to JQuery some time ago and I like this change but still I do have to
    support old code with AjaxTags. What if I switch to other (way to sexier) ajax
    library in the future? Support hell (tm) on horizon..."
- id: 1392
  author: Daniel Kvasnicka
  author_email: daniel.kvasnicka.jr@gmail.com
  author_url: http://www.danielkvasnicka.net
  date: '2008-01-25 10:36:04 +0100'
  date_gmt: '2008-01-25 09:36:04 +0100'
  content: "Nice to see that Stripes is gaining attention here! It surely deserves
    it, as it brings fresh air to JEE, IMHO.\r\n\r\nI've always managed to do what
    I wanted with Taconite+jQuery or simple JavaScriptResolution+jQuery, but these
    examples might come handy one day..thanks ;)"
- id: 1612
  author: Makub
  author_email: makub@ics.muni.cz
  author_url: ''
  date: '2008-02-26 11:55:54 +0100'
  date_gmt: '2008-02-26 10:55:54 +0100'
  content: I think that the reason for the strange JavaScript code generated by Stripes
    instead of JSON is that the Stripes' JavaScriptResolution class allows to send
    graphs of objects with circular dependencies, while plain JSON can send only a
    tree of objects, not an arbitrary graph.
- id: 1616
  author: Novoj
  author_email: novotnaci@gmail.com
  author_url: http://blog.novoj.net
  date: '2008-02-26 19:15:07 +0100'
  date_gmt: '2008-02-26 18:15:07 +0100'
  content: That makes sense. But unfortunatelly in common case it is unnecessary and
    and only confuses standard client libraries. But thanks for explaining. Can I
    ask you where did you find that information?
- id: 158211
  author: 袚芯褉褟褖懈械 褌褍褉褘 胁 袝谐懈锌械褌,孝褍褉褑懈褞, 袨袗袝, 袣懈锌褉, 孝邪懈谢邪薪写, 袠薪写懈褞, 楔褉懈-袥邪薪泻褍, 袚褉械褑懈褞,
    袠褋锌邪薪懈褞 懈 胁 写褉褍谐懈械 褋褌褉邪薪
  author_email: ''
  author_url: http://tourshop.com.ua/mac-lipstick-reviews-free-shipping-pr9t4nbl08/
  date: '2016-05-17 11:28:58 +0200'
  date_gmt: '2016-05-17 10:28:58 +0200'
  content: |-
    <strong>袚芯褉褟褖懈械 褌褍褉褘 胁 袝谐懈锌械褌,孝褍褉褑懈褞, 袨袗袝, 袣懈锌褉, 孝邪懈谢邪薪写, 袠薪写懈褞, 楔褉懈-袥邪薪泻褍, 袚褉械褑懈褞, 袠褋锌邪薪懈褞 懈 胁 写褉褍谐懈械 褋褌褉邪薪褘 锌芯 写芯褋褌褍锌薪褘屑 褑械薪邪屑 -褌褍褉邪谐械薪褋褌胁芯 TourShop www.tourshop.com.ua</strong>

    natural mac makeup Factory Price 17yDMBjRlF | Denver Cleaning Services, Denver Maid Service
---
<div style="margin: 10px; padding: 5px; border: 1px solid white; background-color: #333333; font-size: 90%">
Though most of articles at this blog are written in my native language - Czech, this one will be different. I have chosen an English to address wider community of Stripes developers - I think there would'nt be enough readers in our beautiful small country. So, please, excuse possible errors and mistakes in the article, I will try my best :-) .
</div>
<h3>Common introduction to AJAX in Stripes</h3>
<p>Stripes framework offers basic but sufficient support for AJAX that is covered with article at <a href="http://www.stripesframework.org/display/stripes/AJAX" target="_ new">official web site</a>. Article recommends using commonly known <a href="http://www.prototypejs.org" target="_new">PrototypeJS</a> AJAX client side library. On the server side, request is processed by Stripes themselves by standard population and execution as any other http request (that means that data from client to server are sent as a standard URL encoded parameters). What you get is correctly populated and validated action bean - and until now you haven't even recognize, that request is made by JavaScript on the client side not even you have to care of it. You can access session, exchange cookies and so on.</p>
<p><a id="more"></a><a id="more-51"></a></p>
<p>After you process incoming request you have several possibilities how to return result:</p>
<ul>
<li>you can return <a href="http://stripes.sourceforge.net/docs/current/javadoc/net/sourceforge/stripes/action/RedirectResolution.html" target="_new">RedirectResolution</a> or <a href="http://stripes.sourceforge.net/docs/current/javadoc/net/sourceforge/stripes/action/ForwardResolution.html" target="_new">ForwardResolution</a> as you are used to when processing standard browser request - then, if the redirect or forward targets JSP or such, typically text/html content is returned as a response of the AJAX request. This output you can easily inject into appropriate container in DOM via setting innerHTML property (prototype has optimized object for this approach - <a href="http://www.prototypejs.org/api/ajax/updater" type="_new">Ajax.Updater</a>)</li>
<li>you can return <a href="http://stripes.sourceforge.net/docs/current/javadoc/net/sourceforge/stripes/ajax/JavaScriptResolution.html" target="_new">JavaScriptResolution</a> giving it Java POJO (could be called DTO too) in a constructor - Stripes then take care of marshalling Java object into JSON snippet of code, which could be easily (see chapter Stripes non-standard JSON result for more details) evaluated on a client side</li>
<li>you can return <a href="http://stripes.sourceforge.net/docs/current/javadoc/net/sourceforge/stripes/action/StreamingResolution.html" target="_new">StreamingResolution</a> directly creating resulting content along with setting specific content type - this choice gives you most freedom but usually means much more effort than previous two options</li>
</ul>
<p>Describing above possibilities you can deduce typical use cases for them:</p>
<ul>
<li>when you are not used to code on the client side or you want to save a lot of your time, you would probably choose first option - returning to client whole HTML snippet replacing or other way modifying part of the original page; on the other hand this option is probably the slowest of all involving JSP interpretation (or other type of presentation layer template)</li>
<li>when you want to keep size of interchanged data small or you want to modify more different parts of the displayed page at once, second option would be better choice allowing you to access data from server in further interpretable form (simple JavaScript object); on the other hand you would have to make a lot of the work on the client depending on amount of needed modifications</li>
<li>only when you need something special or you need to precisely polish resulting response, StreamingResolution should be taken into consideration; it gives you most possibilities for customizing the output but would involve most work</li>
</ul>
<h3>Why Stripes and not DWR?</h3>
<p>Although I like using DWR, I must agree that it is worthy to use native Stripes support. DWR is oriented for direct access to Java objects and invoking their methods. When you have ActionBeans prepared for standard web application, you can use huge part of your code at the controller level (eg. validation, message rendering, interceptors, Spring bean injection, field populating protection and so on). With DWR you'd have to solve a lot of things again.</p>
<p>I think that DWR has better support for AJAX itself  - I haven't ever run into an encoding problem with DWR as with Stripes & jQuery combination (see below), nor I have to solve the format in which DWR is transfering its data (DWR consists of both server and client side library). DWR also supports "server push", has more developed security (request forgery, crossite attack) and so on (I am not aware of having these in Stripes). But seamless integration with web framework is more important if you don't need such advanced features. It just can save a lot of time.</p>
<h3>National characters encoding issue</h3>
<p>This was the first problem I had to solve. You'd run into this issue when sending national characters from your browser while having configured non UTF-8 encoding in LocalePicker in Stripes configuration in web.xml. Let's say, you have your JSPs written in cp1250 encoding, you should then have the same locale set in Stripes LocalePicker configuration, so the Stripes will call request.setCharacterEncoding before any data will have been read from the request. In that combination national characters in request parameters should be ok.</p>
<p>What is the difference with AJAX? The difference is that frameworks such as jQuery or Prototypejs call, when preparing AJAX request, method encodeURIComponent() that will convert all special characters into unicode. This means that data that come in AJAX request are always (or at least this is what I realized) in UTF-8 encoding. So the AJAX request must have been treated differently than standard browser request.</p>
<div style="margin: 10px; padding: 5px; border: 1px solid white; background-color: #333333; font-size: 90%">
<b>Note:</b> Don't be fooled. In Prototypejs there is method with parameter encoding - but even if you set different encoding, characters themselves will be encoded in UTF-8 anyway. Problem is that encoding is set by Prototypejs into request headers, but is not used (and cannot be used because there is no paremeter for encoding in it) when using encodeURIComponent method to convert special characters.
</div>
<h4>What to do?</h4>
<p>For me the solution was quite simple (although I don't like having Stripes configuration twice in my web.xml). This is what I had to do:</p>
<h5>Configure Stripes in web.xml twice:</h5>
<p>[source lang="xml"]<br />
<filter><br />
	<display-name>Stripes Filter</display-name><br />
	<filter-name>StripesFilter</filter-name><br />
	<filter-class>net.sourceforge.stripes.controller.StripesFilter</filter-class><br />
	<init-param><param-name>ActionResolver.UrlFilters</param-name><param-value>WEB-INF/classes</param-value>
	</init-param><br />
	<init-param><param-name>LocalePicker.Locales</param-name><param-value>cs_CZ:windows-1250</param-value>
	</init-param><br />
	... other configuration ...<br />
</filter></p>
<p><filter><br />
	<display-name>Stripes Filter Ajax</display-name><br />
	<filter-name>StripesFilterAjax</filter-name><br />
	<filter-class>net.sourceforge.stripes.controller.StripesFilter</filter-class><br />
	<init-param><param-name>ActionResolver.UrlFilters</param-name><param-value>WEB-INF/classes</param-value>
	</init-param><br />
	<init-param><param-name>LocalePicker.Locales</param-name><param-value>cs_CZ:UTF-8</param-value>
	</init-param><br />
	... other configuration ...<br />
</filter></p>
<p><filter-mapping><br />
	<filter-name>StripesFilter</filter-name><br />
	<url-pattern>*.x</url-pattern><br />
	<dispatcher>REQUEST</dispatcher><br />
</filter-mapping></p>
<p><filter-mapping><br />
	<filter-name>StripesFilterAjax</filter-name><br />
	<url-pattern>*.ajax</url-pattern><br />
	<dispatcher>REQUEST</dispatcher><br />
</filter-mapping><br />
[/source]</p>
<p>This configuration divides Stripes to treat two request differently accodring to extension of the script (*.x or *.ajax). Each of these requests will have character encoding set differently. Unfortunately I didn't find out better way how to distinguish these requests - they look the same to the server.</p>
<p>Until now it is ugly solution. But it allows me to neatly implement action beans. Basic action bean oriented for standard non AJAX access looks like this (there is a lot of code cut from the example):</p>
<p>[source lang="java"]<br />
@UrlBinding("/consultation/newQuery.x")<br />
@StrictBinding<br />
public class NewQueryAction extends AbstractAction implements ValidationErrorHandler {<br />
	@SpringBean<br />
	protected QueryManager queryManager;<br />
	@ValidateNestedProperties({<br />
		@Validate(field = "idIssue", on = "createQuery", required = true),<br />
		@Validate(field = "author", on = "createQuery", required = false),<br />
		@Validate(field = "idUser", on = "createQuery", required = false),<br />
		@Validate(field = "title", on = "createQuery", required = true),<br />
		@Validate(field = "query", on = "createQuery", required = true)<br />
	})<br />
	protected Query query = new Query();<br />
	@AllowBinding<br />
	protected Integer idIssue;<br />
	@AllowBinding</p>
<p>	... some code has been cut ...</p>
<p>	public Resolution createQuery() {<br />
		//create it<br />
		try {<br />
			queryManager.store(query, idIssue, false);<br />
			ctx.getMessages().add(new SimpleMessage("Query was succesfully stored."));<br />
		}<br />
		catch(IssueClosedException e) {<br />
			ValidationErrors errors = ctx.getValidationErrors();<br />
			errors.addGlobalError(new SimpleError("Issue has been already closed. Cannot add another query."));<br />
			return new ForwardResolution("/consultation/newQuery.jsp");<br />
		}<br />
		//query was created<br />
		return new RedirectResolution("/consultation/newQueryConfirmation.jsp");<br />
	}</p>
<p>}<br />
[/source]</p>
<p>And this is its extension for AJAX call.</p>
<p>[source lang="java"]<br />
@UrlBinding("/consultation/newQuery.ajax")<br />
public class NewQueryAjaxAction extends NewQueryAction {<br />
	AjaxPostFormResult result;</p>
<p>	public Resolution handleValidationErrors(ValidationErrors errors) throws Exception {<br />
		return new ActionContextJavaScriptResolution(this);<br />
	}</p>
<p>	public Resolution createQuery() {<br />
		//create it<br />
		try {<br />
			queryManager.store(query, issue, false);<br />
			ctx.getMessages().add(new SimpleMessage(getAccessor().getMessage("consultation.ok.newQuery")));<br />
		}<br />
		catch(IssueClosedException e) {<br />
			ctx.getMessages().add(new SimpleError(getAccessor().getMessage("consultation.issueClosed")));<br />
		}<br />
		//query was created<br />
		return new ActionContextJavaScriptResolution(this);<br />
	}</p>
<p>}<br />
[/source]</p>
<p>Validation and other settings are inherited from the original action bean and only createQuery method is overwritten in AJAX implementation returning different result. If you wonder what ActionContextJavaScriptResolution class is - it is simple extension of JavaScriptResolution building POJO object containing basic information from ActionBean context to be sent to the client (I will include complete code of this resolution at the end of the article along with some demo, so you can use it if you want).</p>
<h3>Stripes non-standard JSON result</h3>
<p>Next thing I have encoutered when trying to execute AJAX calls to Stripes is, that Stripes JavaScriptResolution returns weird JSON code not compatible with jQuery nor Prototypejs. Stripes response contains serveral lines of code that has to be evaluated on the client by calling eval(response), but jQuery as well as Prototypejs looks for one declaration that they execute this way: eval("(" + response + ")"). The response returned by Stripes are not compatible with this way of manipulaiton.</p>
<div style="margin: 10px; padding: 5px; border: 1px solid white; background-color: #333333; font-size: 90%">
<b>Note:</b> Not only jQuery or Prototypejs have problems - even Firebug is somewhat confused when receiving this kind of output. I realized that breakpoints in JavaScript code started to behave strange when debugging around this problem. It looked like Firebug tried to move over the lines returned by Stripes but looking at my calling code. So the cursor of the active called line just jumped for the first run absolutely mistrial, but when patient it returned back and started to go over the expected lines again.
</div>
<h4>Example of Stripes returned JSON</h4>
<p>[source:javascript]<br />
var _sj_root_884441334;<br />
var _sj_27542048 = {actionPath:"/consultation/newQuery.ajax", fieldName:"query.title", fieldValue:""};<br />
var _sj_2509847 = {};<br />
var _sj_31941445 = {errorResult:"
<div class=\"box-2 error\">
<div class=\"roundTop\"></div>
<p><strong>What is wrong:</strong><br>-&nbsp;Title must not be empty.<br>-&nbsp;Captcha was not recognized correctly..<br>-&nbsp;Your name must not be empty<br>-&nbsp;Query content must not be empty<br></p>
</div>
<p>", ok:false, okResult:""};<br />
var _sj_18314597 = [null];<br />
var _sj_5084615 = [null];<br />
var _sj_10206935 = {actionPath:"/consultation/newQuery.ajax", fieldName:"query.query", fieldValue:""};<br />
var _sj_15892877 = {actionPath:"/consultation/newQuery.ajax", fieldName:"captcha", fieldValue:""};<br />
var _sj_126384 = {actionPath:"/consultation/newQuery.ajax", fieldName:"query.query", fieldValue:""};<br />
var _sj_18632438 = {actionPath:"/consultation/newQuery.ajax", fieldName:"query.author", fieldValue:""};<br />
var _sj_25434853 = [null, null];<br />
var _sj_15818864 = [null];<br />
_sj_2509847["captcha"] = _sj_15818864;<br />
_sj_2509847["query.title"] = _sj_5084615;<br />
_sj_5084615[0] = _sj_27542048;<br />
_sj_15818864[0] = _sj_15892877;<br />
_sj_25434853[0] = _sj_126384;<br />
_sj_18314597[0] = _sj_18632438;<br />
_sj_root_884441334 = _sj_31941445;<br />
_sj_31941445.validationErrors = _sj_2509847;<br />
_sj_2509847["query.query"] = _sj_25434853;<br />
_sj_2509847["query.author"] = _sj_18314597;<br />
_sj_25434853[1] = _sj_10206935;<br />
_sj_root_884441334;<br />
[/source]</p>
<h4>Example of expected JSON</h4>
<p>[source:javascript]<br />
{<br />
     errorResult:"cutted HTML content",<br />
     ok:false,<br />
     okResult:"",<br />
     validationErrors? {<br />
          "query.query": [{actionPath:"/consultation/newQuery.ajax", fieldName:"query.query", fieldValue:""}],<br />
          "query.author": [{actionPath:"/consultation/newQuery.ajax", fieldName:"query.author", fieldValue:""}],<br />
          "query.captcha": [{actionPath:"/consultation/newQuery.ajax", fieldName:"captcha", fieldValue:""}],<br />
          "query.title": [{actionPath:"/consultation/newQuery.ajax", fieldName:"query.title", fieldValue:""}]<br />
     }<br />
}<br />
[/source]</p>
<h4>What to do?</h4>
<p>So in jQuery you have to execute requests in following format to be able to process response:</p>
<p>[source lang="java"]<br />
var callback = function(dataFromServer) {<br />
     onFormResult(formDiv, resultDiv, dataFromServer);<br />
};<br />
$.post(url, params, callback, "text");</p>
<p>function onFormResult(formDiv, resultDiv, data) {<br />
     var result = eval(data);<br />
     if (result.ok) alert("OK") else alert("Error");;<br />
}<br />
[/source]</p>
<p>By fourth argument of the jQuery.post method you specify, that in return you expect plain text. This means that jQuery will no further process received response before handling it to your callback method. Processing of the returned data will be then made by you.</p>
<p>I wonder why the Stripes behave like that? Is there anyone who could explain?</p>
<h3>Submitting standard HTML Form via AJAX - Example</h3>
<p>At the end of this article I'd like to show you some simple example with snippets of code that you can you if you like it. It is simple HTML form submit in AJAX way. You can see how it looks like in the clip below.</p>
<p><b><a href="http://files.novoj.net/StripesAJAX/ajax.avi" target="_new">Full resolution of the clip is here.</a></b></p>
<div align="center">
<object width="425" height="350"><param name="movie" value="http://www.youtube.com/v/rFZRpfPgEDg"></param> <embed src="http://www.youtube.com/v/rFZRpfPgEDg" type="application/x-shockwave-flash" width="425" height="350"></embed></object>
</div>
<p>Demo leverages jQuery effects so it looks like quite well (at least I hope so). JavaScript on the client is pretty sraightforward - you just call one method giving it ids of the form and div, that will render errors / ok messages from the server and name of the event that should be called on the server side. Url itself is taken from the form action property.</p>
<p>[source:html]<br />
<stripes:submit name="createQuery" onclick="return invoke('queryForm', 'ajaxResultContainer', 'createQuery');"/><br />
[/source]</p>
<p>Then there si this JavaScript code, that will make an AJAX request and modify page after receiving an response:</p>
<p>[source:javascript]<br />
var defaultStripesExenstion = ".x";<br />
var ajaxStripesExenstion = ".ajax";</p>
<p>/*<br />
* Function that uses jQuery to invoke an action of a form. Slurps the values<br />
* from the form using prototype's 'form.serialize()' method, and then submits<br />
* them to the server using prototype's 'jQuery.post' which transmits the request<br />
* and then renders the resposne text into the named container.<br />
*<br />
* @param formDiv reference to the form object being submitted<br />
* @param resultDivthe name of the HTML container to insert the result into<br />
* @param event the name of the event to be triggered, or null<br />
*/<br />
function invoke(formDiv, resultDiv, event) {<br />
	try {<br />
		var form = $("#" + formDiv + " form");<br />
		var action = form.get(0).action;<br />
		var extIndex = action.indexOf(defaultStripesExenstion);<br />
		//compose ajax url from original form action replacing original stripes script extension<br />
		//with stripes ajax extension configured in web.xml<br />
		var url = action.substr(0, extIndex) +<br />
				  ajaxStripesExenstion +<br />
				  action.substr(extIndex + defaultStripesExenstion.length, action.length);<br />
		//create params from serializing form inputs and add param simulating button click in order to<br />
		//Stripes could find actionBean event handler<br />
		var params = form.serialize();<br />
		if(event != null) params = event + '&' + params;<br />
		//hide errors if visible<br />
		$("#" + resultDiv).hide("slow");<br />
		//fade out the form<br />
		$("#" + formDiv).fadeOut("slow");<br />
		//fire ajax request<br />
		var callback = function(dataFromServer) {<br />
        	onFormResult(formDiv, resultDiv, dataFromServer);<br />
        };<br />
		//set up what to do if AJAX request fails<br />
		$("").ajaxError(onServerError);<br />
		$.post(url, params, callback, "text");<br />
		//return false to button to stop standard submit of the form<br />
		return false;<br />
	} catch(ex) {<br />
		return true;<br />
	}<br />
}</p>
<p>/*<br />
* Method is executed when server returns exception.<br />
*/<br />
function onServerError(event, request, settings, error){<br />
	alert("Server returned an error, form was not probably processed by the server.");<br />
}</p>
<p>/*<br />
* Method is called when server returns non JSON data.<br />
*/<br />
function onServerDataError(data){<br />
	alert("Server has returned data in unknown format.");<br />
}</p>
<p>/*<br />
* Method is called when server returns reply to ajax call.<br />
*<br />
* @param data contains reply from the server<br />
*/<br />
function onFormResult(formDiv, resultDiv, data) {<br />
	try {<br />
		var result = eval(data);<br />
	} catch (ex) {<br />
		onServerDataError(data);<br />
	}<br />
	if (result.ok) {<br />
		onSuccess(formDiv, resultDiv, result);<br />
	} else {<br />
		onError(formDiv, resultDiv, result);<br />
	}<br />
}</p>
<p>/*<br />
* Method is executed, when form was submited with success.<br />
*/<br />
function onSuccess(formDiv, resultDiv, result) {<br />
	$("#" + formDiv).queue(function() {<br />
		$("#" + resultDiv).html(result.okResult).fadeIn("slow");<br />
		$(this).dequeue();<br />
	});<br />
}</p>
<p>/*<br />
* Method is executed, when form was submitted and server returned error.<br />
*/<br />
function onError(formDiv, resultDiv, result) {<br />
	$("#" + resultDiv).html(result.errorResult).show("slow");<br />
	$("#" + formDiv).queue(function () {<br />
		var callback = function() {<br />
			colorizeLabel(this, result);<br />
		};<br />
		$("#" + formDiv + " label").each(callback);<br />
		$("#" + formDiv + " #captchaImage").each(reloadCaptcha);<br />
		$(this).dequeue();<br />
	}).fadeIn("slow");<br />
}</p>
<p>/*<br />
* Reloads captcha image.<br />
*/<br />
function reloadCaptcha() {<br />
	var newSrc = $(this).attr("src");<br />
	var randomAtrribute = "?random=";<br />
	var index = newSrc.indexOf(randomAtrribute);<br />
	if (index > -1) {<br />
		newSrc = newSrc.substring(0, index) + randomAtrribute + new Date().getTime();<br />
	} else {<br />
		newSrc = newSrc + randomAtrribute + new Date().getTime();<br />
	}<br />
	$(this).attr("src", newSrc);<br />
}</p>
<p>/*<br />
* Method will add class "error" to each label, whose input was found in validationErrors object.<br />
* In the oposite way, it removes any possible "error" class from any labes, that currently is not in error.<br />
*/<br />
function colorizeLabel(label, result) {<br />
	var error = result.validationErrors[label.htmlFor];<br />
	var errorIndex = -1;<br />
	if (label.className != null) errorIndex = label.className.indexOf('error');<br />
	if (error != null && errorIndex == -1) {<br />
		label.className = label.className + " error";<br />
	}<br />
	if (error == null && errorIndex > -1) {<br />
		label.className = label.className.substring(0, errorIndex)<br />
				+ label.className.substring(errorIndex + 5, label.className.length);<br />
	}<br />
}<br />
[/source]</p>
<p>On the server side there is action bean shown before. As a result it returns ActionContextJavaScriptResolution(actionBeanContext) that will create simple POJO java object:</p>
<p>[source lang="java"]<br />
/**<br />
 * Simple DTO containing information about form posting:<br />
 *<br />
 * - boolean state flag: ok / not ok<br />
 * - String containing HTML snippet rendering Stripes messages / errors<br />
 * - ValidationErrors object containing details on error fields<br />
 */<br />
public class AjaxPostFormResult {<br />
	private boolean ok;<br />
	private ValidationErrors validationErrors;<br />
	private String okResult = "";<br />
	private String errorResult = "";</p>
<p>	public AjaxPostFormResult(String okResult, String errorResult) {<br />
		this.ok = (errorResult == null);<br />
		this.okResult = okResult;<br />
		this.errorResult = errorResult;<br />
	}</p>
<p>	public AjaxPostFormResult(ValidationErrors validationErrors, String errorResult) {<br />
		this.ok = false;<br />
		this.validationErrors = validationErrors;<br />
		this.errorResult = errorResult;<br />
	}</p>
<p>	public boolean isOk() {<br />
		return ok;<br />
	}</p>
<p>	public ValidationErrors getValidationErrors() {<br />
		return validationErrors;<br />
	}</p>
<p>	public String getOkResult() {<br />
		return okResult;<br />
	}</p>
<p>	public String getErrorResult() {<br />
		return errorResult;<br />
	}<br />
}<br />
[/source]</p>
<p>ActionContextJavaScriptResolution is simple extension of JavaScript resultions that only creates result POJO object based on information that can be found in standard ActionBeanContext. ActionContextJavaScriptResolution uses standard Stripes properties to render HTML containing errors or messages it finds in context - so you needn't to do nothing more than you have to do when creating standard Stripes application. This HTML snippet prepared by the server is then used by Javascript to simply pasting it into specified div.</p>
<p>[source lang="java"]<br />
/**<br />
 *
<p>Resolution that will convert a Java object web to a web of JavaScript objects and arrays, and<br />
 * stream the JavaScript back to the client.  The output of this resolution can be evaluated in<br />
 * JavaScript using the eval() function, and will return a reference to the top level JavaScript<br />
 * object.  For more information see {@link JavaScriptBuilder}</p>
<p> *<br />
 *
<p>Resolution builds up result from the object of current ActionBean context returning simple<br />
 * DTO {@link com.fg.mojefirma.consulting.web.dto.AjaxPostFormResult} with error or ok messages,<br />
 * containing involved validation errors if they occur.</p>
<p> */<br />
public class ActionContextJavaScriptResolution implements Resolution {<br />
	private JavaScriptBuilder builder;</p>
<p>	/**<br />
	 * Constructs a new JavaScriptResolution that will convert the supplied object to JavaScript.<br />
	 *<br />
	 * @param actionBean<br />
	 */<br />
	public ActionContextJavaScriptResolution(ActionBean actionBean) {<br />
		ActionBeanContext ctx = actionBean.getContext();<br />
		Object result;</p>
<p>		HttpServletRequest request = ctx.getRequest();<br />
		ValidationErrors validationErrors = ctx.getValidationErrors();</p>
<p>		if (!validationErrors.isEmpty()) {<br />
			result = new AjaxPostFormResult(<br />
					validationErrors,<br />
					composeErrorsHtml(validationErrors, request)<br />
			);<br />
		} else {<br />
			result = new AjaxPostFormResult(<br />
					composeMessagesHtml(ctx.getMessages(), request),<br />
					composeErrorsHtml(ctx.getMessages(), request)<br />
			);<br />
		}</p>
<p>		this.builder = new JavaScriptBuilder(result);<br />
	}</p>
<p>	/**<br />
     * Converts the object passed in to JavaScript and streams it back to the client.<br />
     */<br />
    public void execute(HttpServletRequest request, HttpServletResponse response) throws Exception {<br />
        response.setContentType("text/javascript");<br />
        this.builder.build(response.getWriter());<br />
        response.flushBuffer();<br />
    }</p>
<p>	/**<br />
	 * Compose HTML snippet with messages based on standard properties enveloping used by Stripes<br />
	 * <html:messages/> tag.<br />
	 * @param messages<br />
	 * @param request<br />
	 * @return<br />
	 */<br />
	private String composeMessagesHtml(List<Message> messages, ServletRequest request) {<br />
		String[] properties = getStandardMessageProperties(request);<br />
		return composeResult(request, messages, properties,<br />
				new MessageFilter() {<br />
					public boolean includeMessage(Message message) {<br />
						return !(message instanceof ValidationError);<br />
					}<br />
				}<br />
			);<br />
	}</p>
<p>	/**<br />
	 * Compose HTML snippet with messages based on standard properties enveloping used by Stripes<br />
	 * <html:errors/> tag.<br />
	 * @param messages<br />
	 * @param request<br />
	 * @return<br />
	 */<br />
	private String composeErrorsHtml(List<Message> messages, ServletRequest request) {<br />
		String[] properties = getStandardErrorProperties(request);<br />
		return composeResult(request, messages, properties,<br />
				new MessageFilter() {<br />
					public boolean includeMessage(Message message) {<br />
						return (message instanceof ValidationError);<br />
					}<br />
				}<br />
			);<br />
	}</p>
<p>	/**<br />
	 * Compose HTML snippet with messages based on standard properties enveloping used by Stripes<br />
	 * <html:messages/> tag.<br />
	 * @param errors<br />
	 * @param request<br />
	 * @return<br />
	 */<br />
	private String composeErrorsHtml(ValidationErrors errors, ServletRequest request) {<br />
		String[] properties = getStandardErrorProperties(request);<br />
		List<Message> messages = new ArrayList<Message>();<br />
		for(List<ValidationError> validationErrors : errors.values()) {<br />
			messages.addAll(validationErrors);<br />
		}<br />
		return composeResult(request, messages, properties,<br />
				new MessageFilter() {<br />
					public boolean includeMessage(Message message) {<br />
						return true;<br />
					}<br />
				}<br />
			);<br />
	}</p>
<p>	/**<br />
	 * Returns standard message Stripes properties in array.<br />
	 * @param request<br />
	 * @return<br />
	 */<br />
	private String[] getStandardMessageProperties(ServletRequest request) {<br />
		Locale locale = request.getLocale();<br />
        ResourceBundle bundle = StripesFilter.getConfiguration()<br />
				.getLocalizationBundleFactory().getErrorMessageBundle(locale);<br />
		return new String[] {<br />
				bundle.getString("stripes.messages.header"),<br />
				bundle.getString("stripes.messages.footer"),<br />
				bundle.getString("stripes.messages.beforeMessage"),<br />
				bundle.getString("stripes.messages.afterMessage")<br />
		};<br />
	}</p>
<p>	/**<br />
	 * Returns standard message Stripes properties in array.<br />
	 * @param request<br />
	 * @return<br />
	 */<br />
	private String[] getStandardErrorProperties(ServletRequest request) {<br />
		Locale locale = request.getLocale();<br />
        ResourceBundle bundle = StripesFilter.getConfiguration()<br />
				.getLocalizationBundleFactory().getErrorMessageBundle(locale);<br />
		return new String[] {<br />
				bundle.getString("stripes.errors.header"),<br />
				bundle.getString("stripes.errors.footer"),<br />
				bundle.getString("stripes.errors.beforeError"),<br />
				bundle.getString("stripes.errors.afterError")<br />
		};<br />
	}</p>
<p>	/**<br />
	 * Renders HTML snippet result containing all messages conforming to MessageFilter implementation<br />
	 * enveloped by properties strings.<br />
	 * @param request<br />
	 * @param messages<br />
	 * @param properties<br />
	 * @param messageFilter<br />
	 * @return<br />
	 */<br />
	private String composeResult(ServletRequest request, List<Message> messages, String[] properties, MessageFilter messageFilter) {<br />
		boolean hasMessages = false;<br />
		StringBuffer result = new StringBuffer(properties[0]);<br />
		for(Message message : messages) {<br />
			if (messageFilter.includeMessage(message)) {<br />
				hasMessages = true;<br />
				result.append(properties[2])<br />
						.append(message.getMessage(request.getLocale()))<br />
						.append(properties[3]);<br />
			}<br />
		}<br />
		if (hasMessages) {<br />
			result.append(properties[1]);<br />
			return result.toString();<br />
		} else {<br />
			return null;<br />
		}<br />
	}</p>
<p>	/**<br />
	 * Interface used to filter messages going to output.<br />
	 */<br />
	private interface MessageFilter {</p>
<p>		/**<br />
		 * Returns true or false if message should render in output.<br />
		 * @param message<br />
		 * @return<br />
		 */<br />
		boolean includeMessage(Message message);</p>
<p>	}</p>
<p>}<br />
[/source]</p>
<p>And that's all. I believe that this solution and code is transferable to any other HTML form. I hope that this will help you to AJAXize your plain HTML forms without much effort.</p>
<h3>Links and sources</h3>
<ul>
<li><a href="http://www.stripesframework.org/display/stripes/AJAX" target="_new">Stripes AJAX documentation with example</a></li>
<li><a href="http://docs.jquery.com/Ajax" target="_new">jQuery ajax documentation</a></li>
<li><a href="http://www.thescripts.com/forum/thread499662.html" target="_new">Post containing some informations about JSON expected format</a></li>
<li><a href="http://ims.co.nz/blog/archive/2006/06/06/1810.aspx" target="_new">Why encodeURIComponent is used by JavaScript frameworks</a></li>
<li><a href="http://ajax.phpmagazine.net/2006/11/prototype_encoding_issue.html" target="_new">Some details about encoding problem</a></li>
<li><a href="http://getahead.org/dwr/" target="_new">Direct Web Remoting - AJAX for Java</a></li>
</ul>
